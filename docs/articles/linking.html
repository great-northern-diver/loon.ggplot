<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Linking and missing data • loon.ggplot</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Linking and missing data">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="default" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">loon.ggplot</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.3.5</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/grammarOfInteractiveGraphics.html">A Grammar of Interactive Graphics</a></li>
    <li><a class="dropdown-item" href="../articles/linking.html">Linking</a></li>
    <li><a class="dropdown-item" href="../articles/pipes.html">Pipes</a></li>
    <li><a class="dropdown-item" href="../articles/ggplot2loon.html">ggplots to loon plots</a></li>
    <li><a class="dropdown-item" href="../articles/loon2ggplot.html">loon plots to ggplots</a></li>
    <li><a class="dropdown-item" href="../articles/thereAndBackAgain.html">There and back again</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/great-northern-diver/loon.ggplot" aria-label="GitHub repository for loon.ggplot"><span class="fa fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Linking and missing data</h1>
                        <h4 data-toc-skip class="author">R. W. Oldford
and Zehao Xu</h4>
            
            <h4 data-toc-skip class="date">2025-06-11</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/great-northern-diver/loon.ggplot/blob/HEAD/vignettes/linking.Rmd" class="external-link"><code>vignettes/linking.Rmd</code></a></small>
      <div class="d-none name"><code>linking.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="loons-linking-model">loon’s linking model<a class="anchor" aria-label="anchor" href="#loons-linking-model"></a>
</h2>
<p>Loon’s linking model has the following three parts</p>
<ul>
<li>a <code>linkingGroup</code> which identifies which plots are
linked</li>
<li>a <code>linkingKey</code>, a character vector where each element is
a key uniquely identifying a single observation in the plot (no two
observations in the same plot can have the same value in the linking
key), and</li>
<li>the <em>linked display states</em> each plot has declared (e.g. see
<code>l_getlinkedStates()</code>).</li>
</ul>
<p>Observations in different plots (in the same linking group) are
linked (in that their linked states change together) if and only if they
have the same linking key.</p>
<p>Points appearing in different plots (in the same
<code>linkingGroup</code>) which matched on the value of their
<code>linkingKey</code> will share the same value for their linked
states.</p>
</div>
<div class="section level2">
<h2 id="missing-data">missing data<a class="anchor" aria-label="anchor" href="#missing-data"></a>
</h2>
<p>Loon’s linking model works perfectly when the dataset being plotted
is complete, that is when there are no missing values for any of the
variables being plotted. It even works well when there are missing
values, with no effort (for the most part) on the part of the user.</p>
<p><strong>Key</strong> to making this all work <strong>is maintaining
the correct linking key</strong> for each observation in the plot.
Observations in two different but linked plots are identified as being
the same if and only if their linking key matches. Hence, managing the
linking key correctly is essential to linking plots.</p>
<p>To see how this works, we first need a small dataset with missing
values.</p>
<div class="section level3">
<h3 id="an-artificial-example">an artificial example<a class="anchor" aria-label="anchor" href="#an-artificial-example"></a>
</h3>
<p>Consider the following artificially generated dataset:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>A <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">19</span>, <span class="fl">19</span>, <span class="fl">25</span>, <span class="fl">62</span>, <span class="fl">34</span>, </span>
<span>                         <span class="fl">98</span>, <span class="fl">62</span>, <span class="fl">40</span>, <span class="fl">24</span>, <span class="fl">60</span>, </span>
<span>                         <span class="fl">70</span>, <span class="fl">40</span>, <span class="fl">40</span>, <span class="fl">34</span>, <span class="fl">26</span><span class="op">)</span>,</span>
<span>                   B <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">68</span>, <span class="fl">63</span>, <span class="fl">63</span>,  <span class="fl">4</span>, <span class="fl">95</span>,</span>
<span>                         <span class="fl">78</span>, <span class="fl">14</span>, <span class="fl">14</span>, <span class="cn">NA</span>, <span class="fl">28</span>,</span>
<span>                         <span class="cn">NA</span>, <span class="fl">95</span>, <span class="fl">74</span>, <span class="fl">40</span>, <span class="fl">78</span><span class="op">)</span>,</span>
<span>                   C <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">48</span>, <span class="fl">56</span>, <span class="fl">48</span>, <span class="fl">39</span>, <span class="fl">64</span>,</span>
<span>                         <span class="fl">52</span>, <span class="fl">48</span>, <span class="fl">24</span>, <span class="fl">41</span>, <span class="fl">52</span>,</span>
<span>                         <span class="fl">35</span>, <span class="fl">35</span>, <span class="fl">41</span>, <span class="cn">NA</span>, <span class="fl">39</span><span class="op">)</span></span>
<span>                   <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt;        A               B               C        </span></span>
<span><span class="co">#&gt;  Min.   :19.00   Min.   : 4.00   Min.   :24.00  </span></span>
<span><span class="co">#&gt;  1st Qu.:25.50   1st Qu.:28.00   1st Qu.:39.00  </span></span>
<span><span class="co">#&gt;  Median :40.00   Median :63.00   Median :44.50  </span></span>
<span><span class="co">#&gt;  Mean   :43.53   Mean   :54.92   Mean   :44.43  </span></span>
<span><span class="co">#&gt;  3rd Qu.:61.00   3rd Qu.:78.00   3rd Qu.:51.00  </span></span>
<span><span class="co">#&gt;  Max.   :98.00   Max.   :95.00   Max.   :64.00  </span></span>
<span><span class="co">#&gt;                  NA's   :2       NA's   :1</span></span></code></pre></div>
<p>There are 15 observations in the dataset; variable <code>A</code> is
complete (has no missing values), whereas variables <code>B</code> and
<code>C</code> are missing 2 and 1 observations, respectively.</p>
<div class="section level4">
<h4 id="linked-plots">linked plots<a class="anchor" aria-label="anchor" href="#linked-plots"></a>
</h4>
<p>Interactive <code>ggplot</code>s can be created using the interactive
grammar as follows</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># prelims</span></span>
<span><span class="va">rowNums</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="va">AorB</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">A</span><span class="op">)</span><span class="op">|</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">B</span><span class="op">)</span></span>
<span><span class="va">AorC</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">A</span><span class="op">)</span><span class="op">|</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">C</span><span class="op">)</span></span>
<span><span class="va">BorC</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">B</span><span class="op">)</span><span class="op">|</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">C</span><span class="op">)</span></span>
<span><span class="va">size</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span></span>
<span><span class="co"># B vs A scatterplot</span></span>
<span><span class="va">titleStringBvsA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"plot 1, missing: "</span>, </span>
<span>                          <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">rowNums</span><span class="op">[</span><span class="va">AorB</span><span class="op">]</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ggp1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">data</span>, </span>
<span>               mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">A</span>, y <span class="op">=</span> <span class="va">B</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="va">titleStringBvsA</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"grey"</span>, size <span class="op">=</span> <span class="va">size</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/linking.html">linking</a></span><span class="op">(</span>linkingGroup <span class="op">=</span> <span class="st">"NA example"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># C vs A scatterplot</span></span>
<span><span class="va">titleStringCvsA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"plot 2, missing: "</span>, </span>
<span>                          <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">rowNums</span><span class="op">[</span><span class="va">AorC</span><span class="op">]</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ggp2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">data</span>, </span>
<span>               mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">A</span>, y <span class="op">=</span> <span class="va">C</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="va">titleStringCvsA</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"grey"</span>, size <span class="op">=</span> <span class="va">size</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/linking.html">linking</a></span><span class="op">(</span>linkingGroup <span class="op">=</span> <span class="st">"NA example"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># C vs B scatterplot</span></span>
<span><span class="va">titleStringCvsB</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"plot 3, missing: "</span>, </span>
<span>                          <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">rowNums</span><span class="op">[</span><span class="va">BorC</span><span class="op">]</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ggp3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">data</span>, </span>
<span>               mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">B</span>, y <span class="op">=</span> <span class="va">C</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="va">titleStringCvsB</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"grey"</span>, size <span class="op">=</span> <span class="va">size</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/linking.html">linking</a></span><span class="op">(</span>linkingGroup <span class="op">=</span> <span class="st">"NA example"</span><span class="op">)</span></span></code></pre></div>
<p>Each of these can be turned into interactive plots using
<code><a href="../reference/loon.ggplot.html">loon.ggplot()</a></code></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lp1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/loon.ggplot.html">loon.ggplot</a></span><span class="op">(</span><span class="va">ggp1</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed {9, 11} as the 2 observations which contain missing values.</span></span>
<span><span class="va">lp2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/loon.ggplot.html">loon.ggplot</a></span><span class="op">(</span><span class="va">ggp2</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed {14} as the 1 observation which contains missing values.</span></span>
<span><span class="va">lp3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/loon.ggplot.html">loon.ggplot</a></span><span class="op">(</span><span class="va">ggp3</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed {9, 11, 14} as the 3 observations which contain missing values.</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># and (using gridExtra's grid.arrange() function)</span></span>
<span><span class="co"># appear as </span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">gridExtra</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">lp1</span>, draw <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>, </span>
<span>             <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">lp2</span>, draw <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>, </span>
<span>             <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">lp3</span>, draw <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>, </span>
<span>             nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="linking_files/figure-html/interactive%20plots-1.png" width="100%" style="display: block; margin: auto;"></p>
<p>Note that warning messages appear when missing data were detected and
removed from the plotting.</p>
</div>
<div class="section level4">
<h4 id="effect-of-linking">effect of linking<a class="anchor" aria-label="anchor" href="#effect-of-linking"></a>
</h4>
<p>Being linked, if the participating linked states are changed in one
of the plots, these will result in changes in the other two plots in the
linking group <code>"NA example"</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># First choose some points in the first interactive plot</span></span>
<span><span class="va">selection</span> <span class="op">&lt;-</span> <span class="va">lp1</span><span class="op">[</span><span class="st">"x"</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fl">50</span> <span class="op">&amp;</span> <span class="va">lp1</span><span class="op">[</span><span class="st">"x"</span><span class="op">]</span> <span class="op">&lt;</span> <span class="fl">80</span></span>
<span><span class="va">lp1</span><span class="op">[</span><span class="st">"selected"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">selection</span></span>
<span><span class="va">colorMeRed</span> <span class="op">&lt;-</span> <span class="va">lp1</span><span class="op">[</span><span class="st">"x"</span><span class="op">]</span> <span class="op">==</span> <span class="fl">34</span></span>
<span><span class="va">lp1</span><span class="op">[</span><span class="st">"color"</span><span class="op">]</span><span class="op">[</span><span class="va">colorMeRed</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"red"</span></span>
<span></span>
<span><span class="co"># And the plots now look like</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">lp1</span>, draw <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>, </span>
<span>             <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">lp2</span>, draw <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>, </span>
<span>             <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">lp3</span>, draw <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>, </span>
<span>             nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="linking_files/figure-html/changes%20to%20fake%20data%20plot-1.png" width="100%" style="display: block; margin: auto;"></p>
<p>Now all (programmatic) interactions were carried out on
<code>lp1</code>, the leftmost plot <code>plot 1</code>, and these were
then pushed to the other two plots <code>lp2</code> and
<code>lp3</code>, appearing here titled with <code>plot 2</code> and
<code>plot 3</code>. As <code>plot 1</code> shows, two red points appear
at <code>A == 34</code> and three selected (magenta) points between 50
and 80.</p>
<p>Only one red point appears in <code>plot 2</code> and
<code>plot 3</code>; the value is missing on variable <code>C</code> for
one of the two red points in <code>plot 1</code>, so it cannot appear in
either <code>plot 2</code> or <code>plot 3</code>. This the missing
value 14 (i.e., the <code>NA</code> in row 14, variable <code>C</code>,
of <code>data</code>).</p>
<p>Three magenta coloured points appear in all three plots.<br>
In <code>plot 1</code> (i.e., <code>lp1</code>), these points have
<code>"x"</code> value (<code>lp1["x"]</code>), or value of variable
<code>A</code>, between 50 and 80. Note that in <code>plot 2</code>
(i.e., <code>lp2</code>) has a fourth point with a value in this range
for <code>A</code>. However, it does not appear highlighted because this
point is missing in <code>plot 1</code> – its value on <code>B</code> is
missing.</p>
</div>
<div class="section level4">
<h4 id="linking-keys">linking keys<a class="anchor" aria-label="anchor" href="#linking-keys"></a>
</h4>
<p>The linking works as expected because the <code>linkingKey</code> is
determined at the creation of <em>each</em> plot <code>lp1</code>,
<code>lp2</code>, and <code>lp3</code>. The linking keys of each plot
are as follows:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lp1</span><span class="op">[</span><span class="st">"linkingKey"</span><span class="op">]</span></span>
<span><span class="co">#&gt;  [1] "0"  "1"  "2"  "3"  "4"  "5"  "6"  "7"  "9"  "11" "12" "13" "14"</span></span>
<span><span class="va">lp2</span><span class="op">[</span><span class="st">"linkingKey"</span><span class="op">]</span></span>
<span><span class="co">#&gt;  [1] "0"  "1"  "2"  "3"  "4"  "5"  "6"  "7"  "8"  "9"  "10" "11" "12" "14"</span></span>
<span><span class="va">lp3</span><span class="op">[</span><span class="st">"linkingKey"</span><span class="op">]</span></span>
<span><span class="co">#&gt;  [1] "0"  "1"  "2"  "3"  "4"  "5"  "6"  "7"  "9"  "11" "12" "14"</span></span></code></pre></div>
<p>These strings uniquely identify each observation.</p>
<p>By default, the linking keys are the strings <code>"0"</code>,
<code>"1"</code>, … , <code>"n - 1"</code> where <code>"n"</code> is
<code>nrow(data) =</code> 15. This is simply a zero-based indexing of
the rows from the dataset used <strong>when the plot was
created</strong>. The row numbers of the data are had from the (default)
linking key of each plot as follows:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># The row numbers of `data` in each plot</span></span>
<span><span class="co"># lp1</span></span>
<span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">lp1</span><span class="op">[</span><span class="st">"linkingKey"</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1]  1  2  3  4  5  6  7  8 10 12 13 14 15</span></span>
<span><span class="co"># lp2</span></span>
<span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">lp2</span><span class="op">[</span><span class="st">"linkingKey"</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 15</span></span>
<span><span class="co"># lp3</span></span>
<span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">lp3</span><span class="op">[</span><span class="st">"linkingKey"</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1]  1  2  3  4  5  6  7  8 10 12 13 15</span></span></code></pre></div>
<p>The user can also provide any vector of unique strings as the linking
key.<br>
For example,</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">newUniqueKeys</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"linking key number"</span>, <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Using these keys, the calls would now appear as</span></span>
<span><span class="va">ggp1_stringKeys</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">data</span>, </span>
<span>                          mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">A</span>, y <span class="op">=</span> <span class="va">B</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"plot 1: string keys"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"grey"</span>, size <span class="op">=</span> <span class="va">size</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/linking.html">linking</a></span><span class="op">(</span>linkingGroup <span class="op">=</span> <span class="st">"NA example"</span>, linkingKey <span class="op">=</span> <span class="va">newUniqueKeys</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># C vs A scatterplot</span></span>
<span><span class="va">ggp2_stringKeys</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">data</span>, </span>
<span>                          mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">A</span>, y <span class="op">=</span> <span class="va">C</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"plot 2: string keys"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"grey"</span>, size <span class="op">=</span> <span class="va">size</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/linking.html">linking</a></span><span class="op">(</span>linkingGroup <span class="op">=</span> <span class="st">"NA example"</span>, linkingKey <span class="op">=</span> <span class="va">newUniqueKeys</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># C vs B scatterplot</span></span>
<span><span class="va">ggp3_stringKeys</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">data</span>, </span>
<span>                          mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">B</span>, y <span class="op">=</span> <span class="va">C</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"plot 3: string keys"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"grey"</span>, size <span class="op">=</span> <span class="va">size</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/linking.html">linking</a></span><span class="op">(</span>linkingGroup <span class="op">=</span> <span class="st">"NA example"</span>, linkingKey <span class="op">=</span> <span class="va">newUniqueKeys</span><span class="op">)</span></span></code></pre></div>
<p>These would be turned interactive as follows</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lp1_stringKeys</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/loon.ggplot.html">loon.ggplot</a></span><span class="op">(</span><span class="va">ggp1_stringKeys</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed {9, 11} as the 2 observations which contain missing values.</span></span>
<span><span class="va">lp2_stringKeys</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/loon.ggplot.html">loon.ggplot</a></span><span class="op">(</span><span class="va">ggp2_stringKeys</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed {14} as the 1 observation which contains missing values.</span></span>
<span><span class="va">lp3_stringKeys</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/loon.ggplot.html">loon.ggplot</a></span><span class="op">(</span><span class="va">ggp3_stringKeys</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed {9, 11, 14} as the 3 observations which contain missing values.</span></span></code></pre></div>
<p>and can be interacted with as before, now for example:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">colorMeBlue</span> <span class="op">&lt;-</span> <span class="va">lp1_stringKeys</span><span class="op">[</span><span class="st">"x"</span><span class="op">]</span> <span class="op">&lt;</span> <span class="fl">50</span> </span>
<span><span class="va">lp1_stringKeys</span><span class="op">[</span><span class="st">"color"</span><span class="op">]</span><span class="op">[</span><span class="va">colorMeBlue</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"blue"</span></span></code></pre></div>
<p>These, and the earlier three plots, now appear as.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">lp1</span>, draw <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>, </span>
<span>             <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">lp2</span>, draw <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>, </span>
<span>             <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">lp3</span>, draw <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>, </span>
<span>             <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">lp1_stringKeys</span>, draw <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>, </span>
<span>             <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">lp2_stringKeys</span>, draw <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>, </span>
<span>             <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">lp3_stringKeys</span>, draw <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>, </span>
<span>             nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="linking_files/figure-html/unnamed-chunk-5-1.png" width="100%" style="display: block; margin: auto;">
Note that <em>all</em> six plots belong to the same linking group</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lp1</span><span class="op">[</span><span class="st">"linkingGroup"</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] "NA example"</span></span>
<span><span class="va">lp1_stringKeys</span><span class="op">[</span><span class="st">"linkingGroup"</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] "NA example"</span></span></code></pre></div>
<p>While all six plots are linked, changes require that linking keys
also match. Linking keys are shared by plots in the first row and by
plots in the second row, but not between plots in the first row and
plots in the second. The number of linking keys in common between
different pairs of plot is easily determined as follows:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://generics.r-lib.org/reference/setops.html" class="external-link">intersect</a></span><span class="op">(</span><span class="va">lp1</span><span class="op">[</span><span class="st">"linkingKey"</span><span class="op">]</span>, <span class="va">lp2</span><span class="op">[</span><span class="st">"linkingKey"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 12</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://generics.r-lib.org/reference/setops.html" class="external-link">intersect</a></span><span class="op">(</span><span class="va">lp1_stringKeys</span><span class="op">[</span><span class="st">"linkingKey"</span><span class="op">]</span>, <span class="va">lp2_stringKeys</span><span class="op">[</span><span class="st">"linkingKey"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 12</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://generics.r-lib.org/reference/setops.html" class="external-link">intersect</a></span><span class="op">(</span><span class="va">lp1</span><span class="op">[</span><span class="st">"linkingKey"</span><span class="op">]</span>, <span class="va">lp1_stringKeys</span><span class="op">[</span><span class="st">"linkingKey"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0</span></span></code></pre></div>
<p>Both linking group <strong>and</strong> linking key must match.</p>
</div>
<div class="section level4">
<h4 id="challenges-if-chaining-loon-ggplot">challenges if chaining <code>loon.ggplot()</code><a class="anchor" aria-label="anchor" href="#challenges-if-chaining-loon-ggplot"></a>
</h4>
<p>Linking problems can possibly arise whenever a <code>ggplot</code>
constructed from a <code>loon</code> plot is then made interactive
again.</p>
<p>Suppose a <code>loon</code> plot, like <code>lp1</code>, is turned
into a <code>ggplot</code> (typically, after some interactive changes)
via <code><a href="../reference/loon.ggplot.html">loon.ggplot()</a></code>, and the resulting new
<code>ggplot</code> is then itself turned into another interactive plot.
The new interactive plot will not necessarily share the same linking
information as the original.</p>
<p>This is because the second interactive plot will have the default
values of <code>linkingGroup</code>, <code>linkingKey</code> and linked
display states; the values of these from the first interactive plot were
lost in the transformation to the <code>ggplot</code>. That is,</p>
<ul>
<li>the <em>linking group</em> is not automatically carried over to the
second interactive plot</li>
<li>the <em>linked states</em> are not automatically carried over to the
second interactive plot</li>
<li>the default <em>linking keys</em> in the second interactive plot are
<code>"0"</code>, …, <code>"n-1"</code> where <code>n</code> is the
number of observations that were displayed in the first plot.</li>
</ul>
<p>Moreover, should the first plot have some observations
<code>"selected"</code>, when building the <code>ggplot</code> the data
are reordered so that those that were <code>"selected"</code> appear on
top (as they do in an interactive plot). This change in order means that
an interactive plot produced from this <code>ggplot</code> will have the
data in a different order than the first interactive plot, causing the
default linking keys to match different observations in the two
plots.</p>
<p>There is no problem in linking if the first interactive plot</p>
<ul>
<li>has no observations selected,</li>
<li>has default linking keys, and</li>
<li>was built with a data set having no missing values.</li>
</ul>
<p>Otherwise, the calls to the transformations might be adjusted as
follows. If the interactive plot <code>lp1</code> has observations
selected, then the <code>ggplot</code> will preserve the order of the
observations will be preserved with the argument
<code>selectedOnTop = FALSE</code>, as in</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get a ggplot from the loon plot, make sure the selected points</span></span>
<span><span class="co"># do not change the order of the </span></span>
<span><span class="va">ggp_lp1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/loon.ggplot.html">loon.ggplot</a></span><span class="op">(</span><span class="va">lp1</span>, selectedOnTop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>Also, when data are missing or non-default linking keys are being
used, the linking keys (and possibly linking group) have to be carried
over from the original interactive plot to the next, as in</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lp_ggp_l1_lk</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/loon.ggplot.html">loon.ggplot</a></span><span class="op">(</span><span class="va">ggp_lp1</span>, </span>
<span>                            linkingKey <span class="op">=</span> <span class="va">lp1</span><span class="op">[</span><span class="st">"linkingKey"</span><span class="op">]</span>, </span>
<span>                            linkingGroup <span class="op">=</span> <span class="st">"NA example"</span><span class="op">)</span></span></code></pre></div>
<p>Then the two interactive plots will link properly.</p>
<p>Fortunately, a chain of transformations (e.g., <code>ggplot</code> to
<code>loon</code> to <code>ggplot</code> to <code>loon</code>, etc.)
will rarely arise in practice. More usual will be a single
transformation step, either <code>loon</code> to <code>ggplot</code> OR
<code>ggplot</code> to <code>loon</code>.</p>
<p>For more on changes incurred by the transformations and the effects
of chaining see the vignette <code>There and back again</code>.</p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Zehao Xu, R. Wayne Oldford.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
