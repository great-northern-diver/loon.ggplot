<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ggplots  loon plots • loon.ggplot</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="ggplots &lt;--&gt; loon plots">
<meta property="og:description" content="loon.ggplot">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">loon.ggplot</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/ggplots2loon.html">ggplots &lt;--&gt; loon plots</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/great-northern-diver/loon.ggplot/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>ggplots &lt;–&gt; loon plots</h1>
                        <h4 class="author">Wayne Oldford and Zehao Xu</h4>
            
            <h4 class="date">2020-05-24</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/great-northern-diver/loon.ggplot/blob/master/vignettes/ggplots2loon.Rmd"><code>vignettes/ggplots2loon.Rmd</code></a></small>
      <div class="hidden name"><code>ggplots2loon.Rmd</code></div>

    </div>

    
    
<p>The <code>ggplot2</code> graphics package (part of the <code>tidyverse</code> package collection) uses the base <code>grid</code> graphics package to produce publication quality graphics for data analysis. Based on a grammar for graphics, <code>ggplot2</code> also provides a lot of functionality (e.g. <code>facet</code>s) that can be extremely useful in data analysis.</p>
<p>The <code>loon</code> graphics package provides <strong>interactive</strong> graphics especially valuable in any <strong>exploratory data analysis</strong>. This includes programmatic and direct manipulation of the visualizations to effect interactive identification, zooming, panning, and linking between any number of displays. Of course, <code>loon</code> also provides publication quality static graphics in <code>grid</code> via loon’s functions <code>grid.loon()</code> and <code>loonGrob()</code>. In particular, the standard <code>R</code> <code><a href="https://rdrr.io/r/base/plot.html">plot()</a></code> function has been specialized to produce a <code>grid</code> version of any <code>loon</code> plot.</p>
<p>The loon.ggplot package <strong>brings both these packages together</strong>. Data analysts who value the ease with which <code>ggplot2</code> can create meaningful graphics can now <strong>turn these <code>ggplot</code>s into interactive <code>loon</code> plots</strong> for more dynamic interaction with their data. Conversely, data analysts who explore data interactively can at any time turn a snapshot of their interactive <code>loon</code> plots into <code>ggplot</code>s. The former is accomplished by the simple translation function <code><a href="../reference/ggplot2loon.html">ggplot2loon()</a></code> and the latter by the simple translation function <code><a href="../reference/loon2ggplot.html">loon2ggplot()</a></code>.</p>
<div id="ggplot---loon" class="section level1">
<h1 class="hasAnchor">
<a href="#ggplot---loon" class="anchor"></a>ggplot -&gt; Loon</h1>
<p>Turning a <code>ggplot</code> into an interactive <code>loon</code> plot.</p>
<div id="basics" class="section level2">
<h2 class="hasAnchor">
<a href="#basics" class="anchor"></a>Basics</h2>
<div id="ggplot" class="section level3">
<h3 class="hasAnchor">
<a href="#ggplot" class="anchor"></a>ggplot()</h3>
<p>Consider the <code>mtcars</code> data set and suppose we draw a scatterplot of the mileage <code>mpg</code> (miles per US gallon) versus the weight of the car <code>wt</code> in thousands of pounds. In <code>ggplot2</code> this would be constructed as</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="no">p1</span> <span class="kw">&lt;-</span> <span class="fu">ggplot</span>(<span class="no">mtcars</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">wt</span>, <span class="no">mpg</span>)) + <span class="fu">geom_point</span>()</pre></body></html></div>
<p>and displayed by printing the <code>"ggplot"</code> data structure <code>p1</code> as</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">p1</span></pre></body></html></div>
<p><img src="ggplots2loon_files/figure-html/mpg_vs_wt_ggplot_display-1.png" width="50%" style="display: block; margin: auto;"></p>
<p>We might also display a histogram of some other variate, say the engine’s horsepower <code>hp</code>. In <code>ggplot2</code> this would be constructed as</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">h1</span> <span class="kw">&lt;-</span> <span class="fu">ggplot</span>(<span class="no">mtcars</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">hp</span>)) + <span class="fu">geom_histogram</span>()</pre></body></html></div>
<p>and displayed as</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">h1</span></pre></body></html></div>
<p><img src="ggplots2loon_files/figure-html/hp_ggplot_display-1.png" width="50%" style="display: block; margin: auto;"></p>
</div>
<div id="ggplot2loon-and-grid-loon-or-plot-loon" class="section level3">
<h3 class="hasAnchor">
<a href="#ggplot2loon-and-grid-loon-or-plot-loon" class="anchor"></a><code>ggplot2loon()</code> and <code>grid.loon()</code> or <code>plot.loon()</code>
</h3>
<p>Using the <code>loon.ggplot</code> package, the <code>"ggplot"</code> data structures <code>p1</code> and <code>h1</code> can be <strong>turned into interactive loon plots</strong> using the <code><a href="../reference/ggplot2loon.html">ggplot2loon()</a></code> function:</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">loon.ggplot</span>)
<span class="no">l_p1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/ggplot2loon.html">ggplot2loon</a></span>(<span class="no">p1</span>)  <span class="co"># the scatterplot</span>
<span class="no">l_h1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/ggplot2loon.html">ggplot2loon</a></span>(<span class="no">h1</span>)  <span class="co"># the histogram</span></pre></body></html></div>
<p>These loon plots should look very much (though not exactly) like the ggplot from which it was constructed. Using <code>grid.loon()</code> <code>grid</code> graphics versions of the loon plots can be created for static display, printing, and incorporation into documents:</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="fu">grid.loon</span>(<span class="no">l_p1</span>)</pre></body></html></div>
<p><img src="ggplots2loon_files/figure-html/grid_version_of_l_p1-1.png" width="50%" style="display: block; margin: auto;"></p>
<p>Alternatively, and more simply, we can use the usual <code>plot</code> function in <code>R</code> which has a method for <code>loon</code> objects (<code>plot</code> is essentially “syntactic sugar” since it simply calls <code>grid.loon()</code>)</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">l_h1</span>)   <span class="co"># equivalent to grid.loon(l_h1)</span></pre></body></html></div>
<p><img src="ggplots2loon_files/figure-html/grid_version_of_l_h1-1.png" width="50%" style="display: block; margin: auto;"></p>
</div>
<div id="interaction---direct-manipulation" class="section level3">
<h3 class="hasAnchor">
<a href="#interaction---direct-manipulation" class="anchor"></a>interaction - direct manipulation</h3>
<p>Unlike <code>p1</code> and <code>h1</code>, the loon counterparts <code>l_p1</code> and <code>l_h1</code> are both <strong>interactive</strong>; their displays can be changed by <strong>direct manipulation</strong> using the mouse and/or each loon plot’s <strong>loon inspector</strong>.</p>
<p><img src="img/ggplots2loon/inspector_l_p1.png" width="25%" style="display: block; margin: auto;"></p>
<p>For example, points in the loon scatterplot <code>l_p1</code>, can be selected with a mouse (<code>&lt;SHIFT&gt;</code> select for multiple selection) and their glyph changed in shape or color, for example. Scrolling over the plot causes zooming and <code>&lt;RIGHT-BUTTON&gt;</code> (or <code>&lt;SECONDARY-BUTTON&gt;</code>, depending on your mouse setup) can be used to pan the plot (the same can be done via the “World View” of the inspector).</p>
<p>If, for example, the <code>itemLabels</code> box is checked in the inspector, then hovering over any point will pop a little “tool tip” identifying the point.</p>
<p>Similarly, the loon histogram <code>l_h1</code> has many interactions and a specialized loon inspector. For example, the histogram can be changed from <code>frequency</code> to <code>density</code> in the inspector and the “bin handle” turned on and off; the latter can be directly manipulated to change the size and location of the bins whenever it appears on the histogram plot.</p>
<p>Many, many, more interactions are possible. You might want to experiment with the plot and the inspector to see some of the possibilities. (<strong>Recommended:</strong> explore the vignettes given in the <code>loon</code> package).</p>
<div id="linking" class="section level4">
<h4 class="hasAnchor">
<a href="#linking" class="anchor"></a>linking</h4>
<p>One of the basic features of interactive statistical graphics is the ability to <strong>link displays</strong>. In loon this is most easily accomplished via the loon inspector.</p>
<p>To see the effect, with the mouse select one of the loon plots <code>l_p1</code> or <code>l_h1</code> and then select the inspector. On the inspector, type the text <code>mtcars</code> into the text input box which appears next to “linking group”; then hit return/enter. As a result, the text appearing there will be <code>mtcars [1 linked]</code>; this shows that the selected plot is participating in the linking group named “mtcars” and that it is presently the only one so linked.</p>
<p>Now select the other plot <code>l_h1</code> or <code>l_p1</code>. On the loon inspector for this plot, you can again enter “mtcars” as this plot’s linking group (this can be done as before or selected from the menu accessible from the down arrow next to the linking group. As soon as the second plot is linked, the user is prompted to choose how to synchronize the linked features of the new plot to the previous plot. The choice is between <em>pushing</em> the display features from the current plot to the rest of the plots in the group and <em>pulling</em> the display features from the group to change those of the current plot. The resulting linking group entry should now show <code>mtcars [2 linked]</code>.</p>
<p>Once the both plots are in the same linking group (i.e. “mtcars”), selections in one plot will be reflected in the other. Try this. To see colour changes in the histogram, the box <code>stacked colors</code> must be checked.</p>
<p>Linking is one way to condition on the values in one plot and observe their effect in the others. Try this with “brushing” in either plot.</p>
</div>
</div>
<div id="interaction---programmatic" class="section level3">
<h3 class="hasAnchor">
<a href="#interaction---programmatic" class="anchor"></a>interaction - programmatic</h3>
<p>The loon plot, <code>l_p1</code> is itself a data structure of class <code>"l_plot"</code> and <code>"loon"</code></p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span>(<span class="no">l_p1</span>)
<span class="co">#&gt; [1] "l_plot" "loon"</span>
<span class="no">l_p1</span>
<span class="co">#&gt; [1] ".l0.ggplot.plot"</span>
<span class="co">#&gt; attr(,"class")</span>
<span class="co">#&gt; [1] "l_plot" "loon"</span></pre></body></html></div>
<p>whose value is a string which uniquely identifies it. As such, it can be interacted with programmatically as well as by direct manipulation using the mouse and/or the plot’s loon inspector.</p>
<p>For example, via direct manipulation, the plot might have zoomed or panned so that many of the points no longer appear in the plot. The plot can be returned to its original position and scaling (either through the loon inspector’s <code>scale to: plot</code> or) by calling the function <code>l_scaleto_plot()</code> programmatically on the loon data structure <code>l_p1</code> as in</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="fu">l_scaleto_plot</span>(<span class="no">l_p1</span>)</pre></body></html></div>
<p>As a base loon structure, an <code>l_plot</code> has a variety of <code>l_info_states</code> available that can be accessed and/or set. The names of these states are had with <code><a href="https://rdrr.io/r/base/names.html">names(l_info_states(l_p1))</a></code> or more simply with</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">l_p1</span>)
<span class="co">#&gt;  [1] "glyph"            "itemLabel"        "showItemLabels"   "linkingGroup"    </span>
<span class="co">#&gt;  [5] "linkingKey"       "zoomX"            "zoomY"            "panX"            </span>
<span class="co">#&gt;  [9] "panY"             "deltaX"           "deltaY"           "xlabel"          </span>
<span class="co">#&gt; [13] "ylabel"           "title"            "showLabels"       "showScales"      </span>
<span class="co">#&gt; [17] "swapAxes"         "showGuides"       "background"       "foreground"      </span>
<span class="co">#&gt; [21] "guidesBackground" "guidelines"       "minimumMargins"   "labelMargins"    </span>
<span class="co">#&gt; [25] "scalesMargins"    "x"                "y"                "xTemp"           </span>
<span class="co">#&gt; [29] "yTemp"            "color"            "selected"         "active"          </span>
<span class="co">#&gt; [33] "size"             "tag"              "useLoonInspector" "selectBy"        </span>
<span class="co">#&gt; [37] "selectionLogic"</span></pre></body></html></div>
<p>Their values can be accessed using the <code>[]</code> function. For example, the background grid lines which appear by default on ggplots, are called “guides” in loon and the logical state determining whether they appear or not in the loon plot is <code>"showGuides"</code>, accessed as</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="no">l_p1</span>[<span class="st">"showGuides"</span>]
<span class="co">#&gt; [1] TRUE</span></pre></body></html></div>
<p>These can be turned off (loon default) or on (ggplot default) by simply changing this value – either through the <code>guides</code> check box in the inspector or programmatically as</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="co"># Turn the guides off</span>
<span class="no">l_p1</span>[<span class="st">"showGuides"</span>] <span class="kw">&lt;-</span> <span class="fl">FALSE</span>
<span class="co"># Turn the guides on again</span>
<span class="no">l_p1</span>[<span class="st">"showGuides"</span>] <span class="kw">&lt;-</span> <span class="fl">TRUE</span></pre></body></html></div>
<p>All other info states can also be changed programmatically as well. For example, a title could be added, the axis labels changed, and a highly informative <code>"itemLabel"</code> given for each car.</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="no">l_p1</span>[<span class="st">"title"</span>] <span class="kw">&lt;-</span> <span class="st">"1974 Motor Trend Car Road Tests"</span>
<span class="no">l_p1</span>[<span class="st">"xlabel"</span>] <span class="kw">&lt;-</span> <span class="st">"Curb weight (1000s of lbs)"</span>
<span class="no">l_p1</span>[<span class="st">"ylabel"</span>] <span class="kw">&lt;-</span> <span class="st">"Gas mileage (miles per US gallon)"</span>
<span class="no">newlabels</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(<span class="no">mtcars</span>), <span class="st">"\n   "</span>,
                    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"V-"</span>, <span class="st">"straight-"</span>)[<span class="no">mtcars</span>$<span class="no">vs</span> + <span class="fl">1</span>], <span class="no">mtcars</span>$<span class="no">cyl</span>, <span class="st">" \n   "</span>,
                    <span class="no">mtcars</span>$<span class="no">disp</span>, <span class="st">" cubic inch \n   "</span>,
                    <span class="no">mtcars</span>$<span class="no">gear</span>, <span class="st">" speed \n   "</span>,
                    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"automatic"</span>, <span class="st">"manual"</span>)[<span class="no">mtcars</span>$<span class="no">am</span> + <span class="fl">1</span>]
                    )
<span class="no">l_p1</span>[<span class="st">"itemLabel"</span>] <span class="kw">&lt;-</span> <span class="no">newlabels</span>
<span class="no">l_p1</span>[<span class="st">"showItemLabels"</span>] <span class="kw">&lt;-</span> <span class="fl">TRUE</span></pre></body></html></div>
<p>The last line above ensures its item label appears whenever the mouse hovers over any point. This gives some interesting information to the curious autophile.</p>
<p>The points might also be visibly distinguished by the transmission type and the number of cylinders of its engine. Glyph type could distinguish transmissions and colour the number of cylinders. (To better distinguish shapes, we also make the glyphs fairly large via the <code>size</code> state.)</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="no">l_p1</span>[<span class="st">"size"</span>] <span class="kw">&lt;-</span> <span class="fl">10</span>
<span class="no">l_p1</span>[<span class="st">"glyph"</span>][<span class="no">mtcars</span>$<span class="no">am</span> <span class="kw">==</span> <span class="fl">0</span>] <span class="kw">&lt;-</span> <span class="st">"ccircle"</span>
<span class="no">l_p1</span>[<span class="st">"glyph"</span>][<span class="no">mtcars</span>$<span class="no">am</span> <span class="kw">==</span> <span class="fl">1</span>] <span class="kw">&lt;-</span> <span class="st">"triangle"</span>
<span class="no">gears</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">mtcars</span>$<span class="no">gear</span>))
<span class="no">ngears</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">gears</span>)
<span class="no">cols</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"lightblue"</span>, <span class="st">"steelblue"</span>, <span class="st">"black"</span>)
<span class="kw">for</span> (<span class="no">i</span> <span class="kw">in</span> <span class="fl">1</span>:<span class="no">ngears</span>) {
  <span class="no">l_p1</span>[<span class="st">"color"</span>][<span class="no">mtcars</span>$<span class="no">gear</span> <span class="kw">==</span> <span class="no">gears</span>[<span class="no">i</span>]] <span class="kw">&lt;-</span> <span class="no">cols</span>[<span class="no">i</span>]
}</pre></body></html></div>
<p>We might then zoom in on the <code>"black"</code> coloured points (note that these are now <code>hex colors</code>), and maybe remove the others from the display (temporarily render them inactive) as follows.</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="no">l_p1</span>[<span class="st">"active"</span>] <span class="kw">&lt;-</span> <span class="no">l_p1</span>[<span class="st">"color"</span>] <span class="kw">==</span> <span class="fu">l_hexcolor</span>(<span class="st">"black"</span>)
<span class="fu">l_scaleto_active</span>(<span class="no">l_p1</span>)
<span class="no">l_p1</span>[<span class="st">"title"</span>] <span class="kw">&lt;-</span> <span class="st">"5 speed manual transmission"</span></pre></body></html></div>
<p>The plot should now look something like this (a <code>grid</code> graphics version of <code>l_p1</code>):</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">l_p1</span>)</pre></body></html></div>
<p><img src="ggplots2loon_files/figure-html/high_gear_manual_grid_plot-1.png" width="70%" style="display: block; margin: auto;"></p>
<p>Again, the plot can be returned to its original scale with all points reactivated as follows:</p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="no">l_p1</span>[<span class="st">"active"</span>] <span class="kw">&lt;-</span> <span class="fl">TRUE</span>
<span class="fu">l_scaleto_plot</span>(<span class="no">l_p1</span>)
<span class="no">l_p1</span>[<span class="st">"title"</span>] <span class="kw">&lt;-</span> <span class="st">"All points again"</span>
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">l_p1</span>)</pre></body></html></div>
<p><img src="ggplots2loon_files/figure-html/Back_to_all_points-1.png" width="70%" style="display: block; margin: auto;"></p>
<div id="linking-1" class="section level4">
<h4 class="hasAnchor">
<a href="#linking-1" class="anchor"></a>linking</h4>
<p>In loon, plots are linked only if they are in the same <code>linkingGroup</code> (which can be any string that meaningfully identifies the group of plots). The <code>linkingGroup</code> can also be set programmatically. For the <strong>first</strong> plot in a linking group, this can be set using the square bracket notation as above. For example, instead of “mtcars” we might want a more meaningful string for the linking group for <code>l_p1</code>.</p>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="no">l_p1</span>[<span class="st">"linkingGroup"</span>] <span class="kw">&lt;-</span> <span class="st">"Motor Trend 1974"</span></pre></body></html></div>
<p>The two plots <code>l_p1</code> and <code>l_h1</code> are now no longer linked because they are no longer in the same linking group.</p>
<p>To add <code>l_h1</code> to this new linking group called “Motor Trend 1974”, <strong>the square bracket assignment will no longer work</strong>. This is because the two plots must be synchronized at the time any plot is added to an existing group. Instead, <code>l_h1</code> (and any subsequent plot) must be added to the group using the <code>l_configure()</code> function as follows:</p>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="fu">l_configure</span>(<span class="no">l_h1</span>, <span class="kw">linkingGroup</span> <span class="kw">=</span> <span class="st">"Motor Trend 1974"</span>, <span class="kw">sync</span> <span class="kw">=</span> <span class="st">"pull"</span>)</pre></body></html></div>
<p>Notice, by the way, that the (stacked) colours in the histogram will follow those of <code>l_p1</code>. For example,</p>
<div class="sourceCode" id="cb20"><html><body><pre class="r"><span class="no">l_h1</span>[<span class="st">"showStackedColors"</span>] <span class="kw">&lt;-</span> <span class="fl">TRUE</span>
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">l_h1</span>)</pre></body></html></div>
<p><img src="ggplots2loon_files/figure-html/stacked_colours_plot-1.png" width="70%" style="display: block; margin: auto;"></p>
</div>
<div id="linking-with-ggplot2loon" class="section level4">
<h4 class="hasAnchor">
<a href="#linking-with-ggplot2loon" class="anchor"></a>linking with ggplot2loon()</h4>
<p>It is possible to declare the linking group of the loon plot at the time it is created from the ggplot.</p>
<p>For example, the relationship between the acceleration and the drive axle ratio could be of interest; these are measured by the time taken to accelerate to a quarter mile, <code>qsec</code>, and <code>drat</code>. The <code>gplot</code> is</p>
<div class="sourceCode" id="cb21"><html><body><pre class="r"><span class="co"># First using another ggplot</span>
<span class="no">p2</span> <span class="kw">&lt;-</span> <span class="fu">ggplot</span>(<span class="no">mtcars</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">drat</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">qsec</span>)) + <span class="fu">geom_point</span>()</pre></body></html></div>
<p>which looks like</p>
<div class="sourceCode" id="cb22"><html><body><pre class="r"><span class="no">p2</span></pre></body></html></div>
<p><img src="ggplots2loon_files/figure-html/ggplot_p2-1.png" width="50%" style="display: block; margin: auto;"></p>
<p>The corresponding loon plot can be linked immediately when it is created</p>
<div class="sourceCode" id="cb23"><html><body><pre class="r"><span class="no">l_p2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/ggplot2loon.html">ggplot2loon</a></span>(<span class="no">p2</span>,
                    <span class="kw">linkingGroup</span> <span class="kw">=</span> <span class="st">"Motor Trend 1974"</span>,
                    <span class="kw">title</span> <span class="kw">=</span> <span class="st">"Acceleration measures"</span>,
                    <span class="kw">xlabel</span> <span class="kw">=</span> <span class="st">"Drive axle ratio"</span>,
                    <span class="kw">ylabel</span> <span class="kw">=</span> <span class="st">"Quarter mile (seconds)"</span>,
                    <span class="kw">itemLabel</span> <span class="kw">=</span> <span class="no">newlabels</span>)</pre></body></html></div>
<p>as can any other state of a loon plot, such as <code>title</code>, <code>xlabel</code>, <code>ylabel, or</code>itemLabel` as shown here.<br>
The points in the loon plot inherit their colours from the linking group “Motor Trend 1974”:</p>
<div class="sourceCode" id="cb24"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">l_p2</span>)</pre></body></html></div>
<p><img src="ggplots2loon_files/figure-html/loon_plot_l_p2-1.png" width="70%" style="display: block; margin: auto;"></p>
<p>Note that <code>l_p2</code> did not inherit the shapes of its points from the <code>l_p1</code>. That is because only those states that have been defined as <code>linkedStates</code> are shared by any given plot.</p>
</div>
<div id="linked-states" class="section level4">
<h4 class="hasAnchor">
<a href="#linked-states" class="anchor"></a>linked states</h4>
<p>The <code>linkedStates</code> of any plot are those which that plot will share (and hence update) with any other plot in the same <code>linkingGroup</code>. The default states that are linked for an <code>l_plot</code> like <code>l_p1</code> are</p>
<div class="sourceCode" id="cb25"><html><body><pre class="r"><span class="fu">l_getLinkedStates</span>(<span class="no">l_p1</span>)
<span class="co">#&gt; [1] "color"    "selected" "active"   "size"</span></pre></body></html></div>
<p>and a change in any of these states by any plot in the linking group will cause the same change in these states on <code>l_p1</code>. These are the same states linked by <code>l_p2</code>.</p>
<p>In contrast, the loon histogram <code>l_h1</code> has default linked states</p>
<div class="sourceCode" id="cb26"><html><body><pre class="r"><span class="fu">l_getLinkedStates</span>(<span class="no">l_h1</span>)
<span class="co">#&gt; [1] "color"    "selected" "active"</span></pre></body></html></div>
<p>which excludes <code>size</code> as not a meaningful state for a loon histogram (class <code>l_hist</code>).</p>
<p>The linked states can be modified. For example, we might choose to not have the second plot respond to changes in the “active” state of other plots in the same linking group. This is effected by reducing the states for just the plot <code>l_p2</code></p>
<div class="sourceCode" id="cb27"><html><body><pre class="r"><span class="fu">l_setLinkedStates</span>(<span class="no">l_p1</span>,  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"color"</span>, <span class="st">"selected"</span>, <span class="st">"size"</span>))</pre></body></html></div>
<p>A more sophisticated change would be also link the glyphs used for each point between plots. This will <em>typically</em> be the shape of the glyph. (<strong>Warning</strong>: but not always. For example, when images are used for the points, a little more care needs to be taken). To do this for both <code>l_p1</code> and <code>l_p2</code> we add to the states being linked as follows.</p>
<div class="sourceCode" id="cb28"><html><body><pre class="r"><span class="fu">l_setLinkedStates</span>(<span class="no">l_p1</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"glyph"</span>, <span class="st">"active"</span>, <span class="fu">l_getLinkedStates</span>(<span class="no">l_p1</span>)))
<span class="fu">l_setLinkedStates</span>(<span class="no">l_p2</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"glyph"</span>, <span class="fu">l_getLinkedStates</span>(<span class="no">l_p2</span>)))</pre></body></html></div>
<p>Now any <strong>change</strong> to the glyphs in either plot will change the glyphs in both.</p>
<div class="sourceCode" id="cb29"><html><body><pre class="r"><span class="no">triangles</span> <span class="kw">&lt;-</span> <span class="no">l_p1</span>[<span class="st">"glyph"</span>] <span class="kw">==</span> <span class="st">"triangle"</span>
<span class="no">l_p1</span>[<span class="st">"glyph"</span>][<span class="no">triangles</span>] <span class="kw">&lt;-</span> <span class="st">"ctriangle"</span></pre></body></html></div>
<p>Here now for <code>l_p1</code></p>
<div class="sourceCode" id="cb30"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">l_p1</span>)</pre></body></html></div>
<p><img src="ggplots2loon_files/figure-html/changed_glyphs_l_p1-1.png" width="70%" style="display: block; margin: auto;"> and propagated to <code>l_p2</code></p>
<div class="sourceCode" id="cb31"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">l_p2</span>)</pre></body></html></div>
<p><img src="ggplots2loon_files/figure-html/changed_glyphs_l_p2-1.png" width="70%" style="display: block; margin: auto;"></p>
</div>
</div>
</div>
<div id="layers" class="section level2">
<h2 class="hasAnchor">
<a href="#layers" class="anchor"></a>Layers</h2>
<p>Rather complex plots can be built up in <code>ggplot2</code> by adding <em>layers</em>. For example,</p>
<div class="sourceCode" id="cb32"><html><body><pre class="r"><span class="no">p_fit</span> <span class="kw">&lt;-</span> <span class="fu">ggplot</span>(<span class="no">mtcars</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">drat</span>, <span class="no">mpg</span>)) + <span class="fu">geom_smooth</span>() + <span class="fu">geom_point</span>()
<span class="no">p_fit</span></pre></body></html></div>
<p><img src="ggplots2loon_files/figure-html/mtcars_smooth-1.png" width="70%" style="display: block; margin: auto;"></p>
<p>The <strong>corresponding interactive</strong> loon plot is</p>
<div class="sourceCode" id="cb33"><html><body><pre class="r"><span class="no">l_p_fit</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/ggplot2loon.html">ggplot2loon</a></span>(<span class="no">p_fit</span>)</pre></body></html></div>
<p>As with ggplots (and grid graphics plots), loon plots have layers. These can be identified (and manipulated) by selecting the “Layers” tab of the inspector.</p>
<p><img src="img/ggplots2loon/inspector_l_p_fit.png" width="25%" style="display: block; margin: auto;"></p>
<p>As can be seen, four distinct layers appear. There is the scatterplot (from <code>geom_point()</code>), then a group layer called the <code>smooth</code> which has been opened up here by toggling the triangle at its left to reveal it is composed of a <code>line</code> and a <code>polygon</code> layer (in that order).</p>
<p>The <strong>order of the layers is important</strong> and represent their visual order in the corresponding plot. By default, these will follow the order in which the various <code>geom</code>s appear in the construction of the ggplot. For example, had <code>geom_point()</code> appeared before the <code>geom_smooth()</code> in the left to right reading of the ggplot construction, then the <code>Scatterplot</code> layer would have appeared below the <code>smooth</code> group layer and visually obscured all points at the same location.</p>

<p>The order of display can be changed from the inspector via the first two buttons at the bottom left of the layers panel. The order can also be changed programmatically. For example, the scatterplot can be moved lower in the display order as</p>
<div class="sourceCode" id="cb34"><html><body><pre class="r"><span class="fu">l_layer_lower</span>(<span class="no">l_p_fit</span>, <span class="st">"model"</span>)</pre></body></html></div>
<p>and raised back up again so that the points are again on top</p>
<div class="sourceCode" id="cb35"><html><body><pre class="r"><span class="fu">l_layer_raise</span>(<span class="no">l_p_fit</span>, <span class="st">"model"</span>)</pre></body></html></div>
<p>Note that the scatterplot layer identified by its “layer id”, namely the string <code>"model"</code>. The function <code>l_layer_ids( l_p_fit )</code> will return a list of all the layer ids from its argument <code>l_p_fit</code>.</p>
<p>Reading left to right, the remaining buttons on the bottom of the layers tab on the inspector allow a (selected) layer to be moved out of a group, into a group, made visible, or made invisible, and add a new group layer, delete any layer, or scale the plot to the selected layer. All of these can also be achieved programmatically and numerous other functions exist in loon to add new layers – see <code>help("l_layer")</code> or <code>l_help("learn_R_layer")</code> for the range of possibilities.</p>
<div id="the-model-layer" class="section level3">
<h3 class="hasAnchor">
<a href="#the-model-layer" class="anchor"></a>the model layer</h3>
<p>There is always one layer in loon that is the <strong>active layer</strong> which at present is always identified as the “model” layer. It is this layer which fields mouse events such as selection and brushing; it is also the layer that reacts to changes in linking states.</p>
<p>In loon, scatterplots and histograms can be identified as the “model” layer (the former produced via the <code>l_plot()</code> function, the latter via <code>l_hist()</code>).</p>
<p>A loon <code>l_plot()</code> corresponds to a ggplot <code>geom_point()</code> and a loon <code>l_hist()</code> to a ggplot <code>geom_histogram()</code>.<br>
In <code>ggplot2</code> several <code>geom</code>s might appear in the construction of a plot, each one providing a layer. But in <code>loon</code> only one layer, namely the <code>"model"</code> layer, can be active. This means which of the ggplot layers are intended to be the active <code>"model"</code> layer in loon must be determined at the time of construction (the call to <code><a href="../reference/ggplot2loon.html">ggplot2loon()</a></code>).</p>
<p>Consider the following example where three <code>geom</code>s are created as layers in the ggplot. Here a histogram (on a density scale) is overlaid with a scatter of points along the horizontal axis, and then with a curve from a density estimate.</p>
<div class="sourceCode" id="cb36"><html><body><pre class="r"><span class="no">p_hdp</span> <span class="kw">&lt;-</span> <span class="fu">ggplot</span>(<span class="no">mtcars</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">wt</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">..density..</span>)) +
  <span class="fu">geom_histogram</span>(<span class="kw">binwidth</span> <span class="kw">=</span> <span class="fl">0.5</span>,
                 <span class="kw">fill</span> <span class="kw">=</span> <span class="st">"grey"</span>,
                 <span class="kw">color</span> <span class="kw">=</span> <span class="st">"red"</span>) +
  <span class="fu">geom_density</span>(<span class="kw">color</span> <span class="kw">=</span> <span class="st">"firebrick"</span>, <span class="kw">lwd</span> <span class="kw">=</span> <span class="fl">1.5</span>) +
  <span class="fu">geom_point</span>(<span class="kw">data</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">mtcars</span>$<span class="no">wt</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="fl">0</span>),
             <span class="kw">mapping</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">x</span>, <span class="no">y</span>),
             <span class="kw">color</span> <span class="kw">=</span> <span class="st">"firebrick"</span>, <span class="kw">size</span> <span class="kw">=</span> <span class="fl">3</span>)
<span class="co"># the ggplot</span>
<span class="no">p_hdp</span></pre></body></html></div>
<p><img src="ggplots2loon_files/figure-html/multiple_geoms-1.png" width="70%" style="display: block; margin: auto;"></p>
<p>To render this in loon, which layer will be interactive needs to be determined. By default, this will be the first layer appearing in the construction of the ggplot – in this case the the histogram. The scatter of points will not be interactive and there are presently no interactive curves in a loon plot.</p>
<div id="specifying-the-active-geom-layer" class="section level4">
<h4 class="hasAnchor">
<a href="#specifying-the-active-geom-layer" class="anchor"></a>specifying the active <code>geom</code> layer</h4>
<p>The default active layer is the first <code>geom</code> having a “model” layer counterpart in a loon plot. In this way, the order of construction of the ggplot implicitly determines the <code>geom</code> to be active in loon. Alternatively, the active layer can be explicitly specified when creating the loon plot via the <code>activeGeomLayers</code> argument.</p>
<div class="sourceCode" id="cb37"><html><body><pre class="r"><span class="co"># To have the the histogram active (the first geom in p_hdp)</span>
<span class="no">l_p_Hdp</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/ggplot2loon.html">ggplot2loon</a></span>(<span class="no">p_hdp</span>, <span class="kw">activeGeomLayers</span> <span class="kw">=</span> <span class="fl">1</span>,
                       <span class="kw">linkingGroup</span> <span class="kw">=</span> <span class="st">"Motor Trend 1974"</span>)
<span class="co"># The following creates an error because the line for the density</span>
<span class="co"># is not currently a possible model layer in loon</span>
<span class="co"># ggplot2loon(p_hdp, activeGeomLayers = 2,</span>
<span class="co">#              linkingGroup = "Motor Trend 1974")</span>
<span class="co"># </span>
<span class="co"># To have the points be active (the third geom in p_hdp)</span>
<span class="no">l_p_hdP</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/ggplot2loon.html">ggplot2loon</a></span>(<span class="no">p_hdp</span>, <span class="kw">activeGeomLayers</span> <span class="kw">=</span> <span class="fl">3</span>,
                       <span class="kw">linkingGroup</span> <span class="kw">=</span> <span class="st">"Motor Trend 1974"</span>)</pre></body></html></div>
<p>Note that the colouring will reflect the linking and indicate which layer is actually the active model layer. Check also the layers tab in each of these to see the distinction.</p>
</div>
<div id="multiple-active-layers-with-geom_point" class="section level4">
<h4 class="hasAnchor">
<a href="#multiple-active-layers-with-geom_point" class="anchor"></a>multiple active layers with <code>geom_point()</code>
</h4>
<p>When there are two or more <code>geom_point()</code> layers in the ggplot, it might sometime be of interest to have two or more of these merged into a single active layer.</p>
<p>For example, consider the following ggplot construction</p>
<div class="sourceCode" id="cb38"><html><body><pre class="r"><span class="no">pgps</span> <span class="kw">&lt;-</span> <span class="fu">ggplot</span>(<span class="no">mtcars</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">wt</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">mpg</span>)) +
  <span class="fu">geom_point</span>(<span class="kw">data</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(<span class="no">mtcars</span>, <span class="no">gear</span> <span class="kw">==</span> <span class="fl">3</span>), <span class="kw">col</span> <span class="kw">=</span> <span class="st">"firebrick"</span>) +
  <span class="fu">geom_point</span>(<span class="kw">data</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(<span class="no">mtcars</span>, <span class="no">gear</span> <span class="kw">==</span> <span class="fl">4</span>), <span class="kw">col</span> <span class="kw">=</span> <span class="st">"steelblue"</span>) +
  <span class="fu">geom_point</span>(<span class="kw">data</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(<span class="no">mtcars</span>, <span class="no">gear</span> <span class="kw">==</span> <span class="fl">5</span>), <span class="kw">col</span> <span class="kw">=</span> <span class="st">"black"</span>)
<span class="no">pgps</span></pre></body></html></div>
<p><img src="ggplots2loon_files/figure-html/multiple_geom_points-1.png" width="70%" style="display: block; margin: auto;"></p>
<p>To create the interactive plot, any of the <code>geom_point</code> layers could contribute to the active scatterplot model layer.</p>
<div class="sourceCode" id="cb39"><html><body><pre class="r"><span class="no">l_pgps.1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/ggplot2loon.html">ggplot2loon</a></span>(<span class="no">pgps</span>, <span class="kw">linkingGroup</span> <span class="kw">=</span> <span class="st">"Motor Trend 1974"</span>)
<span class="no">l_pgps.13</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/ggplot2loon.html">ggplot2loon</a></span>(<span class="no">pgps</span>, <span class="kw">activeGeomLayers</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>,<span class="fl">3</span>),
                         <span class="kw">linkingGroup</span> <span class="kw">=</span> <span class="st">"Motor Trend 1974"</span>)
<span class="no">l_pgps.123</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/ggplot2loon.html">ggplot2loon</a></span>(<span class="no">pgps</span>, <span class="kw">activeGeomLayers</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>),
                         <span class="kw">linkingGroup</span> <span class="kw">=</span> <span class="st">"Motor Trend 1974"</span>)</pre></body></html></div>
<p>These plots now have different subsets of the points as their scatterplot “model” or active layer.</p>
<p><strong>WARNING</strong> The linking works as expected <em>between these three</em> plots but <strong>not</strong> with any of the other plots in the same linking group. With a little extra care/work, this too is possible.</p>
</div>
<div id="forcing-the-correct-linking-linkingkey" class="section level4">
<h4 class="hasAnchor">
<a href="#forcing-the-correct-linking-linkingkey" class="anchor"></a>Forcing the correct linking – <code>linkingKey</code>
</h4>
<p>One solution to getting the linking correct is to force the <code>linkingKey</code> of any new plot to match the keys already defined by the other plots in the linking group.</p>
<p>The linking key of a loon plot is simply a character vector (default here)</p>
<div class="sourceCode" id="cb40"><html><body><pre class="r"><span class="co"># this group's linking keys can be found from l_p1</span>
<span class="no">groupKeys</span> <span class="kw">&lt;-</span> <span class="no">l_p1</span>[<span class="st">"linkingKey"</span>]
<span class="no">groupKeys</span>
<span class="co">#&gt;  [1] "0"  "1"  "2"  "3"  "4"  "5"  "6"  "7"  "8"  "9"  "10" "11" "12" "13" "14"</span>
<span class="co">#&gt; [16] "15" "16" "17" "18" "19" "20" "21" "22" "23" "24" "25" "26" "27" "28" "29"</span>
<span class="co">#&gt; [31] "30" "31"</span></pre></body></html></div>
<p>These values need to be selected and matched to the subsetting used by the <code>geom_point()</code> calls in the ggplot.</p>
<div class="sourceCode" id="cb41"><html><body><pre class="r"><span class="co"># the subsets were defined as</span>
<span class="no">dataGeom1</span> <span class="kw">&lt;-</span> <span class="no">mtcars</span>$<span class="no">gear</span> <span class="kw">==</span> <span class="fl">3</span>
<span class="no">dataGeom2</span> <span class="kw">&lt;-</span> <span class="no">mtcars</span>$<span class="no">gear</span> <span class="kw">==</span> <span class="fl">4</span>
<span class="no">dataGeom3</span> <span class="kw">&lt;-</span> <span class="no">mtcars</span>$<span class="no">gear</span> <span class="kw">==</span> <span class="fl">5</span></pre></body></html></div>
<p>As with <code>linkingGroup</code>, any change to <code>linkingKey</code> must also declare whether the existing linked states are to be pushed to, or pulled from, the group. Hence <code>l_configure()</code> must be used.</p>
<div class="sourceCode" id="cb42"><html><body><pre class="r"><span class="fu">l_configure</span>(<span class="no">l_pgps.1</span>,
            <span class="kw">linkingKey</span> <span class="kw">=</span> <span class="no">groupKeys</span>[<span class="no">dataGeom1</span>],
            <span class="kw">sync</span> <span class="kw">=</span> <span class="st">"pull"</span>)
<span class="fu">l_configure</span>(<span class="no">l_pgps.13</span>,
            <span class="kw">linkingKey</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">groupKeys</span>[<span class="no">dataGeom1</span>],
                           <span class="no">groupKeys</span>[<span class="no">dataGeom3</span>]),
            <span class="kw">sync</span> <span class="kw">=</span> <span class="st">"pull"</span>)
<span class="fu">l_configure</span>(<span class="no">l_pgps.123</span>,
            <span class="kw">linkingKey</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">groupKeys</span>[<span class="no">dataGeom1</span>],
                           <span class="no">groupKeys</span>[<span class="no">dataGeom2</span>],
                           <span class="no">groupKeys</span>[<span class="no">dataGeom3</span>]),
            <span class="kw">sync</span> <span class="kw">=</span> <span class="st">"pull"</span>)</pre></body></html></div>
<p><strong>Alternatively</strong>, the linking keys could be set up correctly when the loon plot was created</p>
<div class="sourceCode" id="cb43"><html><body><pre class="r"><span class="no">l_pgps.23</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/ggplot2loon.html">ggplot2loon</a></span>(<span class="no">pgps</span>,
                         <span class="kw">linkingGroup</span> <span class="kw">=</span> <span class="st">"Motor Trend 1974"</span>,
                         <span class="kw">activeGeomLayers</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>,<span class="fl">3</span>),
                         <span class="kw">linkingKey</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">groupKeys</span>[<span class="no">dataGeom2</span>],
                                        <span class="no">groupKeys</span>[<span class="no">dataGeom3</span>])
                         )</pre></body></html></div>
</div>
</div>
</div>
<div id="facets-and-l_compound-plots" class="section level2">
<h2 class="hasAnchor">
<a href="#facets-and-l_compound-plots" class="anchor"></a>Facets and <code>l_compound</code> plots</h2>
<p>A significant data analytic feature in the <code>ggplot</code> pipeline is the notion of faceting the plots, for example, via <code>facet_wrap()</code></p>
<div class="sourceCode" id="cb44"><html><body><pre class="r"><span class="no">fwrap</span> <span class="kw">&lt;-</span> <span class="fu">ggplot</span>(<span class="no">mtcars</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">wt</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">mpg</span>)) +
  <span class="fu">geom_point</span>() +
  <span class="fu">facet_wrap</span>(~ <span class="no">gear</span> + <span class="no">am</span>)
<span class="no">fwrap</span></pre></body></html></div>
<p><img src="ggplots2loon_files/figure-html/fwrap-1.png" width="70%" style="display: block; margin: auto;"> Faceted plots can also be rendered interactive in the same way as any other <code>ggplot</code> objects:</p>
<div class="sourceCode" id="cb45"><html><body><pre class="r"><span class="no">l_fwrap</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/ggplot2loon.html">ggplot2loon</a></span>(<span class="no">fwrap</span>, <span class="kw">linkingGroup</span> <span class="kw">=</span> <span class="st">"Motor Trend 1974"</span>)</pre></body></html></div>
<p>which will look like <img src="img/ggplots2loon/l_fwrap.png" width="70%" style="display: block; margin: auto;"> Note that because we set the <code>linkingGroup</code> at the time of creation (and because the <code>linkingKey</code> is the the default in all plots in this group), the interactive faceted plot has pulled the colours from the other plots in the same <code>linkingGroup</code>.</p>
<p>Note the class of <code>l_fwrap</code>:</p>
<div class="sourceCode" id="cb46"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span>(<span class="no">l_fwrap</span>)
<span class="co">#&gt; [1] "l_ggplot"   "l_compound" "loon"</span></pre></body></html></div>
<p>is an <code>l_ggplot</code> because it is a loon rendition of a more complex <code>ggplot</code>,and it is an <code>l_compound</code> which indicates that it is a composition of individual loon plots.</p>
<p>As an <code>l_compound</code> plot, other features of the composition can be extracted. Such as the list of plots involved in the construction:</p>
<div class="sourceCode" id="cb47"><html><body><pre class="r"><span class="fu">l_getPlots</span>(<span class="no">l_fwrap</span>)
<span class="co">#&gt; $x1y1</span>
<span class="co">#&gt; [1] ".l11.ggplot.plot"</span>
<span class="co">#&gt; attr(,"class")</span>
<span class="co">#&gt; [1] "l_plot" "loon"  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $x1y2</span>
<span class="co">#&gt; [1] ".l11.ggplot.plot1"</span>
<span class="co">#&gt; attr(,"class")</span>
<span class="co">#&gt; [1] "l_plot" "loon"  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $x2y1</span>
<span class="co">#&gt; [1] ".l11.ggplot.plot2"</span>
<span class="co">#&gt; attr(,"class")</span>
<span class="co">#&gt; [1] "l_plot" "loon"  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $x2y2</span>
<span class="co">#&gt; [1] ".l11.ggplot.plot3"</span>
<span class="co">#&gt; attr(,"class")</span>
<span class="co">#&gt; [1] "l_plot" "loon"</span></pre></body></html></div>
<p>as well as their layout in the composition</p>
<div class="sourceCode" id="cb48"><html><body><pre class="r"><span class="fu">l_getLocations</span>(<span class="no">l_fwrap</span>)
<span class="co">#&gt;      [,1] [,2]</span>
<span class="co">#&gt; [1,]    1    2</span>
<span class="co">#&gt; [2,]    3    4</span></pre></body></html></div>
<p>expressed as a matrix of the location of the plots in the order in which they appear in <code>getPlots()</code>.</p>
<p>Each plot in <code>l_fwrap</code> is an independent loon plot which can be interacted with either through the inspector or programmatically.</p>
</div>
<div id="pipes" class="section level2">
<h2 class="hasAnchor">
<a href="#pipes" class="anchor"></a>Pipes</h2>
<p>The <code>magrittr</code> package provides several different types of pipes which can be a handy way to organize computation, especially when the computation involves processing data for input to another procedure, in this case <code>ggplot()</code>:</p>
<div class="sourceCode" id="cb49"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)  <span class="co"># load this to also have dplyr functionality</span>
<span class="no">p1_piped</span> <span class="kw">&lt;-</span> <span class="no">mtcars</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">rename</a></span>(<span class="kw">transmission</span> <span class="kw">=</span> <span class="no">am</span>, <span class="kw">weight</span> <span class="kw">=</span> <span class="no">wt</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">lp100km</span> <span class="kw">=</span> (<span class="fl">100</span> * <span class="fl">3.785411784</span>) / (<span class="fl">1.609344</span> * <span class="no">mpg</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">weight</span>, <span class="no">lp100km</span>) <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">weight</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">lp100km</span>)) +
  <span class="fu">geom_point</span>() +
  <span class="fu">ylab</span>(<span class="st">"Litres per 100 kilometres"</span>) +
  <span class="fu">ggtitle</span>(<span class="st">"Gas usage"</span>)</pre></body></html></div>
<p>Here the “pipe” <code><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></code> takes the output of its left hand side and pushes it into the first argument of its right hand side. Arbitrary many pipes may be gathered together.<br>
This connects nicely with <code>ggplot2</code>’s addition <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code> operator (<code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code> itself is sometimes a pipe, sometimes a layer in <code>ggplot</code> construction) to create the <code>ggplot</code> from the data and assign it to <code>p1_piped</code>.</p>
<p>Two things to note here are. First, the result of the data manipulation is assigned at the beginning using the <code>&lt;-</code> assignment function which seems to run counter to the data flow indicated by the pipes. A more consistent flow would be to have instead written</p>
<div class="sourceCode" id="cb50"><html><body><pre class="r"><span class="no">mtcars</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">rename</a></span>(<span class="kw">transmission</span> <span class="kw">=</span> <span class="no">am</span>, <span class="kw">weight</span> <span class="kw">=</span> <span class="no">wt</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">lp100km</span> <span class="kw">=</span> (<span class="fl">100</span> * <span class="fl">3.785411784</span>) / (<span class="fl">1.609344</span> * <span class="no">mpg</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">weight</span>, <span class="no">lp100km</span>) <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">weight</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">lp100km</span>)) +
  <span class="fu">geom_point</span>() +
  <span class="fu">ylab</span>(<span class="st">"Litres per 100 kilometres"</span>) +
  <span class="fu">ggtitle</span>(<span class="st">"Gas usage"</span>)  <span class="kw">-&gt;</span>   <span class="co"># Note assignment occurs here</span>
  <span class="no">p1_piped</span></pre></body></html></div>
<p>Now the assignment operator <code>-&gt;</code> is used at the end, matching the data flow of the pipes.</p>
<p>Second, in either case the <code>ggplot</code> is <strong>not</strong> itself displayed (or rendered) until it is printed.</p>
<div class="sourceCode" id="cb51"><html><body><pre class="r"><span class="no">p1_piped</span></pre></body></html></div>
<p><img src="ggplots2loon_files/figure-html/p1_piped-1.png" width="70%" style="display: block; margin: auto;"></p>
<p>Once built, as happens when the plot has been displayed as above, an interactive loon plot can be had as always, simply by calling <code><a href="../reference/ggplot2loon.html">ggplot2loon()</a></code> on the built <code>ggplot</code>:</p>
<div class="sourceCode" id="cb52"><html><body><pre class="r"><span class="fu"><a href="../reference/ggplot2loon.html">ggplot2loon</a></span>(<span class="no">p1_piped</span>, <span class="kw">linkingGroup</span> <span class="kw">=</span> <span class="st">"Motor Trend 1974"</span>)
<span class="co">#&gt; [1] ".l12.ggplot.plot"</span>
<span class="co">#&gt; attr(,"class")</span>
<span class="co">#&gt; [1] "l_plot" "loon"</span></pre></body></html></div>
<p>Again, the additional specification here of the <code>linkingGroup</code> will cause display attributes to be pulled from the plots in that linking group.</p>
<div id="using-gg_pipedata-ggplotobj" class="section level3">
<h3 class="hasAnchor">
<a href="#using-gg_pipedata-ggplotobj" class="anchor"></a>Using <code>gg_pipe(data, ggplotObj)</code>
</h3>
<p>Note that before a <code>ggplot</code> can be displayed, a number of steps are performed so as to prepare the plot object for rendering (e.g. see <code><a href="https://ggplot2.tidyverse.org/reference/ggplot_build.html">ggplot2::ggplot_build</a></code>). Unfortunately, this delay in completing the preparation of the <code>ggplot</code> can make it difficult to attach further operations in the <code><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></code> pipeline after the <code>ggplot</code> itself – apart of course from further <code>ggplot2</code> additions via the <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code> operator. For example, one cannot simply add <code>%&gt;% ggplot2loon()</code> at the end of the pipeline used to construct the <code>ggplot</code>. That is,</p>
<div class="sourceCode" id="cb53"><html><body><pre class="r"><span class="no">mtcars</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">rename</a></span>(<span class="kw">transmission</span> <span class="kw">=</span> <span class="no">am</span>, <span class="kw">weight</span> <span class="kw">=</span> <span class="no">wt</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">lp100km</span> <span class="kw">=</span> (<span class="fl">100</span> * <span class="fl">3.785411784</span>) / (<span class="fl">1.609344</span> * <span class="no">mpg</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">weight</span>, <span class="no">lp100km</span>) <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">weight</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">lp100km</span>)) +
  <span class="fu">geom_point</span>() +
  <span class="fu">ylab</span>(<span class="st">"Litres per 100 kilometres"</span>) +
  <span class="fu">ggtitle</span>(<span class="st">"Gas usage"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/ggplot2loon.html">ggplot2loon</a></span>()</pre></body></html></div>
<p>would produce neither a <code>ggplot</code> or an interactive <code>loon</code> plot.</p>
<p>To get around this problem, in <code>loon.ggplot</code> the function <code><a href="../reference/gg_pipe.html">gg_pipe()</a></code> is provided to encapsulate the <code>ggplot</code> construction in any pipeline and force the <code>ggplot</code> to be built (though not rendered in a display). The output of this function can then be passed on to <code><a href="../reference/ggplot2loon.html">ggplot2loon()</a></code>.</p>
<p>For example,</p>
<div class="sourceCode" id="cb54"><html><body><pre class="r"><span class="no">mtcars</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">rename</a></span>(<span class="kw">transmission</span> <span class="kw">=</span> <span class="no">am</span>, <span class="kw">weight</span> <span class="kw">=</span> <span class="no">wt</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">lp100km</span> <span class="kw">=</span> (<span class="fl">100</span> * <span class="fl">3.785411784</span>) / (<span class="fl">1.609344</span> * <span class="no">mpg</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">weight</span>, <span class="no">lp100km</span>) <span class="kw">%&gt;%</span>
  <span class="co"># encapsulate the ggplot construction with gg_pipe()</span>
  <span class="fu"><a href="../reference/gg_pipe.html">gg_pipe</a></span>(<span class="fu">ggplot</span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">weight</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">lp100km</span>)) +
            <span class="fu">geom_point</span>() +
            <span class="fu">ylab</span>(<span class="st">"Litres per 100 kilometres"</span>) +
            <span class="fu">ggtitle</span>(<span class="st">"Gas usage"</span>)
          )  <span class="kw">%&gt;%</span>
  <span class="co"># and pass the built plot on</span>
  <span class="fu"><a href="../reference/ggplot2loon.html">ggplot2loon</a></span>(<span class="kw">linkingGroup</span> <span class="kw">=</span> <span class="st">"Motor Trend 1974"</span>)
<span class="co">#&gt; [1] ".l13.ggplot.plot"</span>
<span class="co">#&gt; attr(,"class")</span>
<span class="co">#&gt; [1] "l_plot" "loon"</span></pre></body></html></div>
<p>constructs the interactive plot which could have been assigned to a variable as was done with the original <code>ggplot</code> construction.</p>
<p>From here, the pipeline can be grown as before, recognizing of course that the output of <code><a href="../reference/ggplot2loon.html">ggplot2loon()</a></code> is a <code>loon</code> plot of some sort. This means that functions that operate on <code>loon</code> plots (as their first argument can be used. As with any piping operation, attention must be given to the first argument of the functions in the pipeline as well as to what the input and outputs are of any function.</p>
<p>For example,</p>
<div class="sourceCode" id="cb55"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">magrittr</span>)
<span class="no">mtcars</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">rename</a></span>(<span class="kw">transmission</span> <span class="kw">=</span> <span class="no">am</span>, <span class="kw">weight</span> <span class="kw">=</span> <span class="no">wt</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">lp100km</span> <span class="kw">=</span> (<span class="fl">100</span> * <span class="fl">3.785411784</span>) / (<span class="fl">1.609344</span> * <span class="no">mpg</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">weight</span>, <span class="no">lp100km</span>) <span class="kw">%&gt;%</span>
  <span class="co"># encapsulate the ggplot construction with gg_pipe()</span>
  <span class="fu"><a href="../reference/gg_pipe.html">gg_pipe</a></span>(<span class="fu">ggplot</span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">weight</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">lp100km</span>)) +
            <span class="fu">geom_point</span>() +
            <span class="fu">ylab</span>(<span class="st">"Litres per 100 kilometres"</span>) +
            <span class="fu">ggtitle</span>(<span class="st">"Gas usage"</span>) )  <span class="kw">%&gt;%</span>
  <span class="co"># and pass the built plot on</span>
  <span class="fu"><a href="../reference/ggplot2loon.html">ggplot2loon</a></span>(<span class="kw">linkingGroup</span> <span class="kw">=</span> <span class="st">"Motor Trend 1974"</span>) <span class="kw">%&gt;%</span>  <span class="co"># pipe the loon plot on</span>
  <span class="fu">l_cget</span>(<span class="st">'color'</span>)  <span class="co"># Gets and returns the vector of point colours</span>
<span class="co">#&gt;  [1] "#46468282B4B4" "#46468282B4B4" "#46468282B4B4" "#ADADD8D8E6E6"</span>
<span class="co">#&gt;  [5] "#ADADD8D8E6E6" "#ADADD8D8E6E6" "#ADADD8D8E6E6" "#46468282B4B4"</span>
<span class="co">#&gt;  [9] "#46468282B4B4" "#46468282B4B4" "#46468282B4B4" "#ADADD8D8E6E6"</span>
<span class="co">#&gt; [13] "#ADADD8D8E6E6" "#ADADD8D8E6E6" "#ADADD8D8E6E6" "#ADADD8D8E6E6"</span>
<span class="co">#&gt; [17] "#ADADD8D8E6E6" "#46468282B4B4" "#46468282B4B4" "#46468282B4B4"</span>
<span class="co">#&gt; [21] "#ADADD8D8E6E6" "#ADADD8D8E6E6" "#ADADD8D8E6E6" "#ADADD8D8E6E6"</span>
<span class="co">#&gt; [25] "#ADADD8D8E6E6" "#46468282B4B4" "#000000000000" "#000000000000"</span>
<span class="co">#&gt; [29] "#000000000000" "#000000000000" "#000000000000" "#46468282B4B4"</span></pre></body></html></div>
<p>In the <code>magrittr</code> package (the source of the pipeline operation) there are a variety of pipeline operators which might also be useful – not just <code><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></code>.</p>
</div>
<div id="using-lggplot" class="section level3">
<h3 class="hasAnchor">
<a href="#using-lggplot" class="anchor"></a>Using <code>lggplot()</code>
</h3>
<p>Additionally, using function <code>lggplot</code>, can also create a <code>loon</code> plot with <code>ggplot</code> pipe model.</p>
<p>The display of <code>ggplot</code> object relies on the default <code><a href="https://rdrr.io/r/base/print.html">print()</a></code> function in <code>R</code>. Function <code>lggplot</code>, inserts a new class <code>lggplot</code> into the original <code>ggplot</code> object. At the printing time, <a href="http://adv-r.had.co.nz/S3.html">S3 method</a> <code><a href="../reference/print.lggplot.html">print.lggplot()</a></code> will be executed to transform a <code>ggplot</code> plot to a <code>loon</code> plot.</p>
<div class="sourceCode" id="cb56"><html><body><pre class="r"><span class="no">obj</span> <span class="kw">&lt;-</span> <span class="no">mtcars</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">rename</a></span>(<span class="kw">transmission</span> <span class="kw">=</span> <span class="no">am</span>, <span class="kw">weight</span> <span class="kw">=</span> <span class="no">wt</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">lp100km</span> <span class="kw">=</span> (<span class="fl">100</span> * <span class="fl">3.785411784</span>) / (<span class="fl">1.609344</span> * <span class="no">mpg</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">weight</span>, <span class="no">lp100km</span>) <span class="kw">%&gt;%</span>
  <span class="co"># replace `ggplot` to `lggplot`</span>
  <span class="fu"><a href="../reference/lggplot.html">lggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">weight</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">lp100km</span>)) +
  <span class="fu">geom_point</span>() +
  <span class="fu">ylab</span>(<span class="st">"Litres per 100 kilometres"</span>) +
  <span class="fu">ggtitle</span>(<span class="st">"Gas usage"</span>)
<span class="no">obj</span></pre></body></html></div>
<p>However, this design has an obvious drawback: confusion of the output data structure. Since the transformation is accomplished at the printing time, object <code>obj</code> is still a <code>ggplot</code> data structure. To create a <code>loon</code> “handle”, we have to use <code>l_getFromPath()</code></p>
<div class="sourceCode" id="cb57"><html><body><pre class="r"><span class="kw">if</span>(<span class="kw pkg">utils</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/utils/packageDescription.html">packageVersion</a></span>(<span class="st">"loon"</span>) <span class="kw">&gt;=</span> <span class="st">"1.2.4"</span>) {
  <span class="co"># **THIS IS IMPORTANT**</span>
  <span class="co"># The path name can be obtained at the top left tk window</span>
  <span class="co"># Suppose the label is "loon.ggplot --path: .l13.ggplot"</span>
  <span class="co"># The path would be the char right after "path: " which is ".l13.ggplot"</span>
  <span class="no">loonWidget</span> <span class="kw">&lt;-</span> <span class="fu">l_getFromPath</span>(<span class="st">".l13.ggplot"</span>)
  <span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span>(<span class="no">loonWidget</span>)
  <span class="co"># [1] "l_plot" "loon"</span>
}</pre></body></html></div>
</div>
<div id="just-use-loon-for-built-in-interactive-plots" class="section level3">
<h3 class="hasAnchor">
<a href="#just-use-loon-for-built-in-interactive-plots" class="anchor"></a>just use loon for built-in interactive plots</h3>
<p>Of course, for plots already existing in <code>loon</code>, <code>ggplot()</code> and hence <code><a href="../reference/gg_pipe.html">gg_pipe()</a></code> could be avoided entirely:</p>
<div class="sourceCode" id="cb58"><html><body><pre class="r"><span class="no">mtcars</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">rename</a></span>(<span class="kw">transmission</span> <span class="kw">=</span> <span class="no">am</span>, <span class="kw">weight</span> <span class="kw">=</span> <span class="no">wt</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">lp100km</span> <span class="kw">=</span> (<span class="fl">100</span> * <span class="fl">3.785411784</span>) / (<span class="fl">1.609344</span> * <span class="no">mpg</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">weight</span>, <span class="no">lp100km</span>) <span class="kw">%&gt;%</span>
  <span class="co"># and pass the built plot on</span>
  <span class="fu">l_plot</span>(<span class="kw">title</span> <span class="kw">=</span> <span class="st">"Gas Usage"</span>,
         <span class="kw">showGuides</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">showScales</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
         <span class="kw">ylabel</span> <span class="kw">=</span> <span class="st">"Litres per 100 kilometres"</span>,
         <span class="kw">linkingGroup</span> <span class="kw">=</span> <span class="st">"Motor Trend 1974"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>()   <span class="co"># get a static version via grid</span></pre></body></html></div>
<p><img src="ggplots2loon_files/figure-html/loon_only_pipe-1.png" width="70%" style="display: block; margin: auto;"></p>
<p>or</p>
<div class="sourceCode" id="cb59"><html><body><pre class="r"><span class="no">mtcars</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">rename</a></span>(<span class="kw">transmission</span> <span class="kw">=</span> <span class="no">am</span>, <span class="kw">weight</span> <span class="kw">=</span> <span class="no">wt</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">lp100km</span> <span class="kw">=</span> (<span class="fl">100</span> * <span class="fl">3.785411784</span>) / (<span class="fl">1.609344</span> * <span class="no">mpg</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">lp100km</span>, <span class="no">weight</span>, <span class="no">transmission</span>) <span class="kw">%&gt;%</span>
  <span class="co"># and pass the built plot on</span>
  <span class="fu">l_pairs</span>(<span class="kw">showHistograms</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
          <span class="kw">linkingGroup</span> <span class="kw">=</span> <span class="st">"Motor Trend 1974"</span>) <span class="kw">-&gt;</span>  <span class="co"># and assign the result.</span>
  <span class="no">l_pp</span></pre></body></html></div>
<p>produces an interactive pairs plot with histograms on the margins (see <code>?l_pairs</code>) and assigns the result to <code>l_pp</code> (which could have been assigned at the beginning with <code>&lt;-</code> as well).</p>
</div>
</div>
</div>
<div id="loon---ggplot" class="section level1">
<h1 class="hasAnchor">
<a href="#loon---ggplot" class="anchor"></a>loon -&gt; ggplot</h1>
<p>In <code>loon</code>, the current view of any <code>loon</code> plot <code>p</code> can be turned into a <code>grid</code> plot in a variety of ways:</p>
<ul>
<li><code><a href="https://rdrr.io/r/base/plot.html">plot(p)</a></code></li>
<li>
<code>grid.loon(p)</code> or <code>grid.loon(p, draw = FALSE)</code>
</li>
<li>
<code>loonGrob(p)</code> to create the grid object.</li>
</ul>
<p>The corresponding <code>grid</code> object is a rich structure that can be exported, printed, edited, and incorporated into other <code>grid</code> structures. However, adapting that structure to slightly different presentations is a bit of a challenge compared to a <code>ggplot</code> (also ultimately a <code>grid</code> structure).</p>
<p>In this section, we turn the current state of any <code>loon</code> plot into a <code>ggplot</code> plot which can then be modified following the rules of the <code>ggplot2</code> grammar.</p>
<div id="loon2ggplot" class="section level2">
<h2 class="hasAnchor">
<a href="#loon2ggplot" class="anchor"></a><code>loon2ggplot()</code>
</h2>
<div class="sourceCode" id="cb60"><html><body><pre class="r"><span class="no">g</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/loon2ggplot.html">loon2ggplot</a></span>(<span class="no">l_pp</span>)
<span class="no">g</span></pre></body></html></div>
<p><img src="ggplots2loon_files/figure-html/p1_piped_staic%20%20ggplot-1.png" width="70%" style="display: block; margin: auto;"></p>
<p>The object <code>g</code> is a <code>ggplot</code> graphic. We can fit a smooth line on the <code>lp100km vs weight</code> scatterplot and draw a density curve on the <code>weight</code> histogram. Additionally, the theme of these plots are adjusted to <code>theme_light</code> to direct more attention towards the data.</p>
<div class="sourceCode" id="cb61"><html><body><pre class="r"><span class="co"># Add a smooth line on g[2,2]</span>
<span class="co"># the index of `lp100km vs weight` scatterplot is </span>
<span class="co"># 1 * 4 + 2</span>
<span class="no">g</span>$<span class="no">plots</span><span class="kw">[[</span><span class="fl">6</span>]] <span class="kw">&lt;-</span> <span class="no">g</span>$<span class="no">plots</span><span class="kw">[[</span><span class="fl">6</span>]] + <span class="fu">geom_smooth</span>()
<span class="co"># Add a density curve on g[1,2]</span>
<span class="co"># the index of `weight` histogram is </span>
<span class="co"># 1 * 4 + 1</span>
<span class="no">g</span>$<span class="no">plots</span><span class="kw">[[</span><span class="fl">5</span>]] <span class="kw">&lt;-</span> <span class="no">g</span>$<span class="no">plots</span><span class="kw">[[</span><span class="fl">5</span>]] + <span class="fu">geom_density</span>()
<span class="co"># Modify theme</span>
<span class="no">g</span> <span class="kw">&lt;-</span> <span class="no">g</span> + <span class="fu">theme_light</span>()
<span class="no">g</span></pre></body></html></div>
<p><img src="ggplots2loon_files/figure-html/p1_piped_modification%20%20ggplot-1.png" width="70%" style="display: block; margin: auto;"></p>
<p>Comparing with static <code>grid</code> (via <code>loonGrob()</code>), modification of <code>ggplot</code> (via <code>loon2ggplot</code>) is simpler and more creative. Moreover, <code>ggplot</code> has over 100 extended packages. After transforming from <code>loon</code> to <code>ggplot</code>, users can continually take advantage of these extensions.</p>
<p><font size="1"> Note that: compound loon widget (the previous example) like <code>l_ts</code> and <code>l_pairs</code> are created by <code><a href="https://rdrr.io/pkg/GGally/man/ggmatrix.html">GGally::ggmatrix</a></code>. Features like <code>theme</code>, <code>labels</code> can be piped through but by <code>ggmatrix</code> rule. The single <code>ggplot</code> object can be extracted by <code>...$plots[[id]]</code>, where <code>id</code> is the index of such object. To <code>M[x, y]</code>, <span class="math inline">\(id = (y-1) \times nrow + x\)</span>, <span class="math inline">\(nrow\)</span> is the number of rows. </font></p>
</div>
<div id="geom-layers" class="section level2">
<h2 class="hasAnchor">
<a href="#geom-layers" class="anchor"></a>Geom layers</h2>
<ul>
<li>Adding glyphs on scatterplot</li>
</ul>
<p>Package <code>loon.ggplot</code> also provides “pointGlyph” layer to create scatterplots with a variety of glyphs, such as polygon glyph, serialaxes glyph, image glyph and etc. Following example illustrates the USA destinations (not including Alaska and Hawaii) of “nyc” flights in 2013. All destinations are marked as a “airplane” polygon symbol and LA is highlighted by a magenta star.</p>
<div class="sourceCode" id="cb62"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">nycflights13</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)
<span class="no">destinations</span> <span class="kw">&lt;-</span> <span class="kw pkg">nycflights13</span><span class="kw ns">::</span><span class="no"><a href="https://rdrr.io/pkg/nycflights13/man/airports.html">airports</a></span> <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">rename</a></span>(<span class="kw">dest</span> <span class="kw">=</span> <span class="no">faa</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/join.html">semi_join</a></span>(<span class="kw pkg">nycflights13</span><span class="kw ns">::</span><span class="no"><a href="https://rdrr.io/pkg/nycflights13/man/flights.html">flights</a></span>, <span class="kw">by</span> <span class="kw">=</span> <span class="st">"dest"</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">lon</span> <span class="kw">&gt;</span> -<span class="fl">151</span>,
                <span class="no">lat</span> <span class="kw">&lt;</span> <span class="fl">55</span>)
<span class="no">LA</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(
  <span class="kw">lon</span> <span class="kw">=</span> -<span class="fl">118.243683</span>,
  <span class="kw">lat</span> <span class="kw">=</span> <span class="fl">34.052235</span>
)
<span class="fu">map_data</span>(<span class="st">"state"</span>) <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">long</span>, <span class="no">lat</span>, <span class="kw">group</span> <span class="kw">=</span> <span class="no">group</span>)) +
  <span class="fu">geom_polygon</span>(<span class="kw">color</span><span class="kw">=</span><span class="st">"black"</span>, <span class="kw">fill</span><span class="kw">=</span><span class="st">"cornsilk"</span>) +
  <span class="fu"><a href="../reference/glyphGeoms.html">geom_polygonGlyph</a></span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">destinations</span>,
                    <span class="kw">mapping</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">lon</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">lat</span>),
                    <span class="kw">inherit.aes</span> <span class="kw">=</span> <span class="fl">FALSE</span>,
                    <span class="kw">polygon_x</span> <span class="kw">=</span> <span class="no">x_airplane</span>,
                    <span class="kw">polygon_y</span> <span class="kw">=</span> <span class="no">y_airplane</span>,
                    <span class="kw">size</span> <span class="kw">=</span> <span class="fl">2</span>,
                    <span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">0.75</span>,
                    <span class="kw">fill</span> <span class="kw">=</span> <span class="st">"deepskyblue"</span>) +
  <span class="fu"><a href="../reference/glyphGeoms.html">geom_polygonGlyph</a></span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">LA</span>,
                    <span class="kw">mapping</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">lon</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">lat</span>),
                    <span class="kw">inherit.aes</span> <span class="kw">=</span> <span class="fl">FALSE</span>,
                    <span class="kw">polygon_x</span> <span class="kw">=</span> <span class="no">x_star</span>,
                    <span class="kw">polygon_y</span> <span class="kw">=</span> <span class="no">y_star</span>,
                    <span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">0.75</span>,
                    <span class="kw">fill</span> <span class="kw">=</span> <span class="st">"red"</span>)</pre></body></html></div>
<p><img src="ggplots2loon_files/figure-html/glyph_ggplot-1.png" width="70%" style="display: block; margin: auto;"></p>
<ul>
<li>
<p>Providing serial axes plots (parallel coordinate or radial coordinate) via <code><a href="../reference/ggSerialAxes.html">ggSerialAxes()</a></code></p>
<div class="sourceCode" id="cb63"><html><body><pre class="r"><span class="co"># parallel axes plot</span>
<span class="fu">ggplot</span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">iris</span>,
       <span class="kw">mapping</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">colour</span> <span class="kw">=</span> <span class="no">Species</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/ggSerialAxes.html">ggSerialAxes</a></span>()</pre></body></html></div>
<p><img src="ggplots2loon_files/figure-html/serialaxes-1.png" width="70%" style="display: block; margin: auto;"></p>
</li>
</ul>
</div>
</div>
<div id="function-loon-ggplot" class="section level1">
<h1 class="hasAnchor">
<a href="#function-loon-ggplot" class="anchor"></a>Function <code>loon.ggplot()</code>
</h1>
<p><code><a href="../reference/loon.ggplot.html">loon.ggplot()</a></code> function in <code>loon.ggplot</code> package is a S3 method and gathers features of both <code><a href="../reference/loon2ggplot.html">loon2ggplot()</a></code> and <code><a href="../reference/ggplot2loon.html">ggplot2loon()</a></code>. It can take either a <code>loon</code> widget or <code>gg</code> object and transform back and forth.</p>
<ul>
<li>Ggplot to loon: <code><a href="../reference/loon.ggplot.html">loon.ggplot(gg)</a></code> is equivalent to <code><a href="../reference/ggplot2loon.html">ggplot2loon(gg)</a></code>.</li>
<li>Loon to ggplot: <code><a href="../reference/loon.ggplot.html">loon.ggplot(loon)</a></code> is equivalent to <code><a href="../reference/loon2ggplot.html">loon2ggplot(loon)</a></code>.</li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Zehao Xu, R. Wayne Oldford.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
